var redirURL="",h5u_albSel=null,stagger=!1;function $id(d){return document.getElementById(d)}function $ae(d,e,f){d.addEventListener(e,f,!1)}function H5up_done(d){var e=".php?album="+h5u_albSel.value;redirURL=0<js_vars.user_id||1==js_vars.guest_edit?js_vars.site_url+"&task=manage.imgEdit&after="+js_vars.timestamp:js_vars.site_url+"/thumbnails"+e;"1"==js_vars.autoedit&&0===d?window.location=redirURL:$id("gotoedit").style.display="table-row"}
function watchAlbNam(d){var e=$id("creab");d.value.trim()?e.disabled=!1:e.disabled=!0}function createAlbum(d){d.disabled=!0;var e=$id("nualbnam"),f=$id("h5u_palbum");e=e.value.trim();d.nextElementSibling.style.visibility="visible";f={task:"manage.newAlbum",albnam:e,paralb:f?f.value:0};jQuery(h5u_albSel).load(js_vars.upLink,f,function(e,f,h){console.log(e,f,h);d.nextElementSibling.style.visibility="hidden";"success"==f?$id("crealbm").style.display="none":alert(h.statusText);d.disabled=!1})}
function o_createAlbum(d){d.disabled=!0;var e=$id("nualbnam"),f=$id("h5u_palbum"),l=e.value.trim();d.nextElementSibling.style.visibility="visible";e=new FormData;e.append("task","manage.newAlbum");e.append("albnam",l);e.append("paralb",f.selectedIndex);f=new XMLHttpRequest;f.onload=function(){d.nextElementSibling.style.visibility="hidden";if(this.responseXML){var e=this.responseXML,f=e.getElementsByTagName("error")[0];f?alert(f.textContent):(l=e.getElementsByTagName("name")[0].textContent,f=e.getElementsByTagName("id")[0].textContent,
alert(e.getElementsByTagName("aselopts")[0].textContent),h5u_albSel.options[h5u_albSel.options.length]=new Option(l,f),$id("crealbm").style.display="none",h5u_albSel.selectedIndex=h5u_albSel.options.length-1,h5u_albSel.value=f)}else alert(this.responseText)};f.open("POST",js_vars.upLink);f.send(e)}
(function(d,e,f){function l(b){h5u_albSel.value||(b.stopPropagation(),b.preventDefault(),alert(js_vars.h5uM.selAlb));-1==h5u_albSel.value&&(b.stopPropagation(),b.preventDefault(),alert("create new album"))}function x(b){b.stopPropagation();b.preventDefault();b.target.className="dragover"==b.type?"hover":""}function h(b){var a,c;C=t.offsetWidth;x(b);if(h5u_albSel.value){y&&(y=z=A=0);b=b.target.files||b.dataTransfer.files;for(a=0;c=b[a];a++)z+=c.size,g.push(c),u.innerHTML=g.length,stagger||n(!1,"fsel");
stagger&&n(!1,"fsel");g.length>v&&(k.style.display="inline-block")}else alert(js_vars.h5uM.selAlb)}function D(){m||(y=1,typeof("function"==H5up_done)&&H5up_done(E))}function n(b,a){b&&(--q||D());if(!m&&g.length&&(!v||q<v)){var c=g.shift();new F(c);q++;u.innerHTML=g.length}0>=g.length&&(k.style.display="none",r.style.display="none")}function G(b,a){var c=this;c.show=function(a){c.pb.style.backgroundPosition=Math.floor(c.pb.offsetWidth*a)+"px 0";1===a&&(c.pb.innerHTML=c.fObj.fileName,c.pb.className=
"indeterm")};c.msg=function(a,b){c.pb.innerHTML+="<br />"+a;b&&(c.pb.className="failure",E++)};c.remove=function(){c.pb._ufo=null;B.removeChild(c.pb);c.fObj=null};c.pb=B.appendChild(document.createElement("p"));a&&(c.pb.className=a);c.pb.appendChild(document.createTextNode(b.fileName));c.pb.innerHTML+='<img src="'+js_vars.H5uPath+'css/redX.png" class="abortX" onclick="this.parentNode._ufo.abort(true);" />';c.pb._ufo=b;c.fObj=b;return this}function w(b){!t||0>b||(A+=b,t.style.backgroundPosition=Math.floor(C*
A/z)+"px 0")}function H(){var b={},a;for(a in f){var c=f[a];$id(c)&&(b[c]=$id(c).value)}b.album=h5u_albSel.value;return b}function p(b,a){for(var c in a)b.append(c,a[c])}function F(b){var a=this;a.upFile=b;a.fileName=b.fileName||b.name;a.size=b.size;a.upState="";a.doChnk=a.upFile.size>js_vars.maxchunksize;a.chnkSize=Math.round(js_vars.maxchunksize/2)-3072;a.relPath=b.webkitRelativePath||a.fileName;a.uniqueId=a.size+"-"+a.relPath.replace(/[^0-9a-zA-Z_-]/img,"");a.actSize=0;a.startByte=0;a.lastsz=0;
a.numChnks=Math.max(Math.floor(a.size/a.chnkSize),1);a.chnkNum=0;a.fData=null;a.upForm=H();a.xhr=new XMLHttpRequest;var c=a.upFile.slice?"slice":a.upFile.mozSlice?"mozSlice":a.upFile.webkitSlice?"webkitSlice":"slice",d=function(b){a.xhr&&(a.xhr.upload.onprogress=null,a.xhr.onabort=null,a.xhr.onerror=null,a.xhr.onload=null,a.xhr=null);a.fData=null;b&&a.pBar&&(a.pBar.remove(),a.pBar=null);n(!0,"ufo")},f=function(){a.fData=new FormData;p(a.fData,js_vars.fup_payload)},g=function(){f();switch(a.upState){case "":p(a.fData,
a.upForm);a.fData.append("userpicture",a.upFile);a.upState="upld";break;case "upld":d(!0);return}a.xhr.open("POST",e);a.xhr.send(a.fData)},l=function(){f();switch(a.upState){case "":p(a.fData,{chunkact:"pref",file:a.fileName,size:a.size,album:h5u_albSel.value});a.upState="chnk";break;case "chnk":p(a.fData,{chunkact:"chnk",identifier:a.uniqueId,filename:a.fileName,totalChunks:a.numChnks});if(a.chnkNum==a.numChnks){d(!0);return}a.startByte=a.chnkNum*a.chnkSize;a.endByte=Math.min(a.size,(a.chnkNum+1)*
a.chnkSize);a.size-a.endByte<a.chnkSize&&(a.endByte=a.size);a.actSize=a.endByte-a.startByte;a.fData.append("chunkNumber",++a.chnkNum);a.chnkNum==a.numChnks&&p(a.fData,a.upForm);a.fData.append("userpicture",a.upFile[c](a.startByte,a.endByte));a.lastsz=0;break;case "abrt":a.xhr.timeout=1E4;p(a.fData,{chunkact:"abrt",identifier:a.uniqueId,filename:a.fileName});a.upState="nil";break;case "nil":d();return}a.xhr.open("POST",e);a.xhr.send(a.fData)},h={prog:function(b){if(b.lengthComputable){var c=Math.round(b.loaded/
b.total*a.actSize);"chnk"==a.upState&&a.chnkNum?(a.pBar.show((a.startByte+c)/a.size),w(c-a.lastsz),a.lastsz=c):"upld"==a.upState&&(a.pBar.show(b.loaded/b.total),c=Math.round(b.loaded/b.total*a.size),w(c-a.lastsz),a.lastsz=c)}},chng:function(b){4>this.readyState||(200!==this.status?(w(a.size-a.startByte-a.lastsz),a.lastsz=a.size,0===this.status?(a.pBar.msg("-- "+js_vars.h5uM.aborted,!0),a.doChnk?(a.upState="abrt",l()):d()):(a.pBar.msg(this.statusText||this.status,!0),d())):200===this.status&&(a.doChnk?
l():g()))},fail:function(b){a.pBar.msg(a.xhr.statusText,!0)}};a.abort=function(b){a.xhr?(b=a.xhr.readyState,4>b&&0!==b?a.xhr.abort():h.abrt()):(a.pBar.remove(),a.pBar=null)};a.pBar=new G(a,a.doChnk?"chunked":"");var k="",m=b.name.split(".");1==m.length||"object"==typeof js_vars.allowed_file_types&&0>js_vars.allowed_file_types.indexOf(m.pop().toLowerCase())?k='<img src="'+js_vars.H5uPath+'css/info.png" class="infog" onclick="showAllowedExts();" /> '+js_vars.h5uM.type_err:b.size>js_vars.maxfilesize&&
(k=js_vars.h5uM.size_err);if(k)a.pBar.msg(k,!0),w(b.size),a.xhr=null,n(!0,"errM");else return a.xhr.onreadystatechange=h.chng,a.xhr.upload.onerror=h.fail,a.xhr.upload.onprogress=h.prog,a.doChnk?l():g(),this}var t,C,B,u,g=[],v=js_vars.concurrent,m=!1,q=0,z=0,A=0,y=0,E=0,k,r;d.H5uSetup=function(){var b=$id("upload_field"),a=$id("dropArea");d.File&&d.FileList?(u=$id("qcount"),k=$id("qstop"),r=$id("qgocan"),b&&($ae(b,"click",l),$ae(b,"change",h)),b=new XMLHttpRequest,b.upload&&($ae(a,"dragover",x),$ae(a,
"dragleave",x),$ae(a,"drop",h),a.style.display="block",t=$id("totprogress"),B=$id("fprogress")),h5u_albSel=document.getElementsByName("h5u_album")[0]):($id("h5upldrow").style.display="none",$id("navailrow").style.display="table-row")};d.H5uQctrl={stop:function(){m=!0;k.style.display="none";r.style.display="inline-block"},go:function(){m=!1;k.style.display="inline-block";r.style.display="none";if(stagger)n(!1,"go");else for(;g.length&&q<v;)n(!1,"go")},cancel:function(){g.length=0;m=!1;r.style.display=
"none";u.innerHTML=0;q||D()}}})(window,js_vars.upLink,"flistitl title caption keywords user1 user2 user3 user4".split(" "));function showAllowedExts(){alert(js_vars.h5uM.extallow+js_vars.allowed_file_types.join(", "))}function shide_titlrow(d){var e=$id("titlrow");d.checked?e.style.display="none":e.style.display="table-row"}jQuery(document).ready(function(){H5uSetup()});
function album_select(d){d=d.options[d.selectedIndex].value;$id("crealbm").style.display=-1==d?"inline-block":"none";$id("nualbnam").focus()};